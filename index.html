<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í”„ë¡œíŒŒì¼ ìë™ê²¬ì </title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background:#f4f6fb;
}

.header{
  background:#1e2a45;
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

.section{
  background:#fff;
  padding:20px;
  margin:12px;
  border-radius:12px;
  box-shadow:0 3px 12px rgba(0,0,0,0.05);
}

.size-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:14px;
}

.size-card{
  background:#eef1f7;
  border-radius:12px;
  padding:15px;
  text-align:center;
  cursor:pointer;
  transition:all 0.2s ease;
  border:2px solid transparent;
}

.size-card:hover{
  transform:translateY(-3px);
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.size-card.active{
  background:#1e2a45;
  color:#fff;
  border:2px solid #1e2a45;
}

.size-card img{
  width:100%;
  max-height:90px;
  object-fit:contain;
  display:block;
  margin:0 auto 10px auto;
}

input,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  background:#1e2a45;
  color:#fff;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

.cart-item{
  background:#f1f3f9;
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
  font-size:14px;
}

.total-box{
  font-weight:bold;
  font-size:18px;
  margin-top:10px;
}

/* ğŸ“± ëª¨ë°”ì¼ ìµœì í™” */
@media(max-width:600px){

  .section{
    margin:10px;
    padding:16px;
  }

  .size-grid{
    grid-template-columns:repeat(2,1fr);
  }

  .header{
    font-size:18px;
  }

  button{
    padding:16px;
    font-size:15px;
  }

}
</style>
</head>

<body>

<div class="header">í”„ë¡œíŒŒì¼ ìë™ê²¬ì </div>

<div class="section">
<h3>1. ê·œê²© ì„ íƒ</h3>
<div id="sizeGrid" class="size-grid"></div>
</div>

<div class="section">
<h3>2. ê¸¸ì´ / ìˆ˜ëŸ‰</h3>
<select id="color">
<option value="silver">ì‹¤ë²„</option>
<option value="black">ë¸”ë™</option>
</select>
<input type="number" id="length" placeholder="ê¸¸ì´(mm)" min="50">
<input type="number" id="qty" placeholder="ìˆ˜ëŸ‰" min="1">
<div class="total-box" id="price">0 ì›</div>
</div>

<div class="section">
<h3>3. ê°€ê³µ ì˜µì…˜</h3>
í•œìª½íƒ­ <input type="number" id="tapOneQty" value="0">
ì–‘ìª½íƒ­ <input type="number" id="tapTwoQty" value="0">
í™€ <input type="number" id="holeQty" value="0">
ì¹´ìš´í„° <input type="number" id="counterQty" value="0">
<button onclick="addToCart()">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
</div>

<div class="section">
<h3>ì¥ë°”êµ¬ë‹ˆ</h3>
<div id="cartList"></div>
<div class="total-box">ì´ í•©ê³„: <span id="grandTotal">0</span> ì›</div>
</div>

<div class="section">
<h3>ê³ ê° ì •ë³´</h3>
<input type="text" id="customerName" placeholder="ì´ë¦„">
<input type="tel" id="customerPhone" placeholder="ì „í™”ë²ˆí˜¸">
<input type="email" id="customerEmail" placeholder="ì´ë©”ì¼">
<input type="text" id="customerAddress" placeholder="ë°°ì†¡ì£¼ì†Œ">
<button onclick="downloadPDF()">PDF ë‹¤ìš´ë¡œë“œ</button>
<button onclick="submitQuote()">ê²¬ì  ìš”ì²­</button>
</div>

<script>

/* ğŸ” Supabase ë‹¨ í•œë²ˆë§Œ ì„ ì–¸ */
window._sb = window.supabase.createClient(
"https://ritzqnjgivmrtysulzil.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpdHpxbmpnaXZtcnR5c3VsemlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5ODA2MjMsImV4cCI6MjA4NzU1NjYyM30.oTeXacJlkMXKw1G4IRWUa3G2DM1wPvFl-9rzf5IdsxY"
);

const prices={
2020:{silver:3900,black:6000},
2040:{silver:6900,black:9000},
3030:{silver:8900,black:11000},
3060:{silver:14000,black:18000},
4040:{silver:16000,black:19000},
4080:{silver:28000,black:30000}
};

let selectedSize="2020";

function createSizeButtons(){

  const grid = document.getElementById("sizeGrid");
  grid.innerHTML = "";

  Object.keys(prices).forEach(size=>{

    const card = document.createElement("div");
    card.className = "size-card";

    card.innerHTML = `
      <img id="img_${size}" src="/images/${size}_silver.png">
      <div>${size}</div>
    `;

    card.onclick = function(){
      document.querySelectorAll(".size-card")
      .forEach(c=>c.classList.remove("active"));

      card.classList.add("active");
      selectedSize = size;

      updateImage();
      updatePrice();
    };

    grid.appendChild(card);
  });

  document.querySelector(".size-card").classList.add("active");
}
function updateImage(){

  const color = document.getElementById("color").value;

  const img = document.getElementById(`img_${selectedSize}`);

  if(img){
    img.src = `/images/${selectedSize}_${color}.png`;
  }

}
function calculateLine(size,color,length,qty,tapOne,tapTwo,hole,counter){
if(length<50||!qty) return 0;
const unit100=Math.ceil(length/100);
const base100=prices[size][color]/10;
let total=unit100*base100*qty;
total+=300*tapOne+600*tapTwo+400*hole+1000*counter;
return total;
}

function updatePrice(){
const color=document.getElementById("color").value;
const length=parseInt(document.getElementById("length").value)||0;
const qty=parseInt(document.getElementById("qty").value)||0;
const tapOne=parseInt(document.getElementById("tapOneQty").value)||0;
const tapTwo=parseInt(document.getElementById("tapTwoQty").value)||0;
const hole=parseInt(document.getElementById("holeQty").value)||0;
const counter=parseInt(document.getElementById("counterQty").value)||0;
const total=calculateLine(selectedSize,color,length,qty,tapOne,tapTwo,hole,counter);
document.getElementById("price").innerText=total.toLocaleString()+" ì›";
}

document.getElementById("color")
.addEventListener("change",function(){
  updateImage();
  updatePrice();
});

  
document.addEventListener("input",updatePrice);

function addToCart(){
const total=document.getElementById("price").innerText;
const div=document.createElement("div");
div.className="cart-item";
div.innerHTML=`${selectedSize} / ${total}
<br><button onclick="this.parentElement.remove();updateGrand();">ì‚­ì œ</button>`;
document.getElementById("cartList").appendChild(div);
updateGrand();
}

function updateGrand(){
let sum=0;
document.querySelectorAll(".cart-item").forEach(e=>{
const match=e.innerText.match(/[\d,]+/);
if(match) sum+=parseInt(match[0].replace(/,/g,""));
});
document.getElementById("grandTotal").innerText=sum.toLocaleString();
}

function downloadPDF(){
const { jsPDF } = window.jspdf;
const doc=new jsPDF();
doc.text("í”„ë¡œíŒŒì¼ ê²¬ì ì„œ",20,20);
doc.text("ì´í•©: "+document.getElementById("grandTotal").innerText+" ì›",20,40);
doc.save("ê²¬ì ì„œ.pdf");
}

async function submitQuote(){

const name=document.getElementById("customerName").value;
const phone=document.getElementById("customerPhone").value;
const email=document.getElementById("customerEmail").value;
const address=document.getElementById("customerAddress").value;

if(!name||!phone||!email){
alert("ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼ ì…ë ¥");
return;
}

const items=[...document.querySelectorAll(".cart-item")].map(e=>e.innerText).join(" | ");
const total=document.getElementById("grandTotal").innerText;

await window._sb.from("quotes").insert([{
name,phone,email,address,items,total,status:"ì ‘ìˆ˜"
}]);

await fetch("/api/send-email",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({name,phone,email,address,items,total})
});

alert("ê²¬ì  ì ‘ìˆ˜ ì™„ë£Œ");
}

createSizeButtons();

</script>
</body>
</html>



