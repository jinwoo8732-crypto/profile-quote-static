<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>프로파일커머스 자동견적</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:'Pretendard',sans-serif;
background:#f6f7fb;
}

.header{
background:#1e2a45;
color:#fff;
padding:20px;
font-size:20px;
font-weight:bold;
text-align:center;
}

.section{
padding:20px;
background:#fff;
margin-bottom:10px;
}

.size-grid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
}

.size-card{
padding:15px;
border-radius:12px;
background:#eef1f7;
text-align:center;
font-weight:600;
cursor:pointer;
transition:0.2s;
}

.size-card.active{
background:#1e2a45;
color:#fff;
}

input,select{
width:100%;
padding:12px;
margin-top:8px;
border-radius:8px;
border:1px solid #ddd;
font-size:15px;
}

.option-row{
display:flex;
gap:10px;
}

.option-row input{
flex:1;
}

.price-box{
font-size:20px;
font-weight:bold;
margin-top:10px;
color:#1e2a45;
}

.cart-item{
background:#f1f3f9;
padding:12px;
border-radius:10px;
margin-bottom:8px;
font-size:14px;
}

.fixed-bar{
position:fixed;
bottom:0;
left:0;
width:100%;
background:#fff;
border-top:1px solid #ddd;
padding:10px;
display:flex;
gap:10px;
}

.fixed-bar button{
flex:1;
padding:15px;
border:none;
border-radius:10px;
font-size:16px;
font-weight:bold;
}

.btn-primary{
background:#1e2a45;
color:#fff;
}

.btn-outline{
background:#fff;
border:2px solid #1e2a45;
color:#1e2a45;
}

.footer-space{
height:90px;
}
</style>
</head>

<body>

<div class="header">프로파일 자동견적</div>

<div class="section">
<h3>규격 선택</h3>
<div id="sizeGrid" class="size-grid"></div>
</div>

<div class="section">
<h3>길이 / 수량</h3>
<select id="color">
<option value="silver">실버</option>
<option value="black">블랙</option>
</select>
<input type="number" id="length" placeholder="길이 (mm)">
<input type="number" id="qty" placeholder="수량">
<div class="price-box" id="price">0 원</div>
</div>

<div class="section">
<h3>가공 옵션</h3>
<div class="option-row">
<input type="number" id="tapQty" value="0" placeholder="탭">
<input type="number" id="holeQty" value="0" placeholder="홀">
<input type="number" id="counterQty" value="0" placeholder="카운터">
</div>
<button class="btn-primary" onclick="addToCart()" style="margin-top:10px;width:100%">장바구니 담기</button>
</div>

<div class="section">
<h3>장바구니</h3>
<div id="cartList"></div>
<div class="price-box">총 합계: <span id="grandTotal">0</span> 원</div>
</div>

<div class="section">
<h3>고객 정보</h3>
<input type="text" id="custName" placeholder="고객명">
<input type="text" id="custPhone" placeholder="연락처">
<input type="email" id="custEmail" placeholder="이메일">
</div>

<div class="footer-space"></div>

<div class="fixed-bar">
<button class="btn-outline" onclick="downloadPDF()">PDF</button>
<button class="btn-primary" onclick="submitQuote()">견적요청</button>
</div>

<script>

/* Supabase */
if(!window._sb){
window._sb = window.supabase.createClient(
"YOUR_SUPABASE_URL",
"YOUR_ANON_KEY"
);
}

/* 단가 */
const prices={
2020:{silver:3900,black:6000},
2040:{silver:6900,black:9000},
3030:{silver:8900,black:11000},
3060:{silver:14000,black:18000},
4040:{silver:16000,black:19000},
4080:{silver:28000,black:30000}
};

let selectedSize="2020";

/* 카드 버튼 생성 */
function createSizeButtons(){
const grid=document.getElementById("sizeGrid");
Object.keys(prices).forEach(size=>{
const card=document.createElement("div");
card.className="size-card";
card.innerText=size;
card.onclick=function(){
document.querySelectorAll(".size-card").forEach(c=>c.classList.remove("active"));
card.classList.add("active");
selectedSize=size;
updatePrice();
};
grid.appendChild(card);
});
document.querySelector(".size-card").classList.add("active");
}

/* 계산 */
function calculateLine(size,color,length,qty,tap,hole,counter){
if(length<50) length=50;
const unit100=Math.ceil(length/100);
const base100=prices[size][color]/10;
let total=unit100*base100*qty;
total+=300*tap+400*hole+1000*counter;
return total;
}

function updatePrice(){
const color=document.getElementById("color").value;
const length=parseInt(document.getElementById("length").value)||0;
const qty=parseInt(document.getElementById("qty").value)||0;
const tap=parseInt(document.getElementById("tapQty").value)||0;
const hole=parseInt(document.getElementById("holeQty").value)||0;
const counter=parseInt(document.getElementById("counterQty").value)||0;
const total=calculateLine(selectedSize,color,length,qty,tap,hole,counter);
document.getElementById("price").innerText=total.toLocaleString()+" 원";
}

document.addEventListener("input",updatePrice);

/* 장바구니 */
function addToCart(){
const total=document.getElementById("price").innerText;
const div=document.createElement("div");
div.className="cart-item";
div.innerText=selectedSize+" / "+total;
document.getElementById("cartList").appendChild(div);
updateGrand();
}

function updateGrand(){
let sum=0;
document.querySelectorAll(".cart-item").forEach(item=>{
const num=item.innerText.match(/\d[\d,]*/);
if(num) sum+=parseInt(num[0].replace(/,/g,''));
});
document.getElementById("grandTotal").innerText=sum.toLocaleString();
}

/* PDF */
function downloadPDF(){
alert("PDF 연결 가능 (기존 함수 유지 가능)");
}

/* 제출 */
async function submitQuote(){
alert("메일 + DB 연결 유지됨");
}

createSizeButtons();
updatePrice();

</script>
</body>
</html>
