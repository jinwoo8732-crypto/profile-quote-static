<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>프로파일 자동견적</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;background:#f4f6fb;margin:0;padding:30px;}
.container{max-width:1100px;margin:auto;background:#fff;padding:30px;border-radius:12px;}
.size-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;}
.size-btn{padding:15px;border:1px solid #ddd;border-radius:8px;background:#f2f2f2;cursor:pointer;}
.size-btn.active{background:#2c3e70;color:#fff;}
input,select{padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:6px;}
button{padding:10px 15px;background:#2c3e70;color:#fff;border:none;border-radius:6px;cursor:pointer;}
.cart table{width:100%;border-collapse:collapse;margin-top:20px;}
.cart th,.cart td{border:1px solid #ddd;padding:6px;text-align:center;}
.cart th{background:#f0f0f0;}
.option-box{display:flex;gap:20px;margin-top:10px;}
.option-box img{width:80px;display:block;margin-bottom:5px;}
.min-msg{color:red;font-size:12px;margin-top:5px;}
</style>
</head>
<body>

<div class="container">

<h2>1. 규격 선택</h2>
<div class="size-grid" id="sizeGrid"></div>

<h2>2. 길이 및 수량</h2>
<select id="color">
<option value="silver">실버</option>
<option value="black">블랙</option>
</select>
<input type="number" id="length" placeholder="길이(mm)" min="50">
<div class="min-msg">※ 최소 50mm 이상 입력</div>
<input type="number" id="qty" placeholder="수량" min="1">
<div id="price">0 원</div>

<h2>3. 가공 옵션</h2>
<div class="option-box">
<div>
<img src="/images/tap_one.png">
한쪽 탭 <input type="number" id="tapOne" value="0">
</div>
<div>
<img src="/images/tap_two.png">
양쪽 탭 <input type="number" id="tapTwo" value="0">
</div>
<div>
<img src="/images/hole.png">
홀 <input type="number" id="holeQty" value="0">
</div>
<div>
<img src="/images/counter.png">
카운터 <input type="number" id="counterQty" value="0">
</div>
</div>

<br>
<button onclick="addToCart()">장바구니 담기</button>

<div class="cart">
<h2>장바구니</h2>
<table>
<thead>
<tr>
<th>규격</th><th>색상</th><th>길이</th><th>수량</th>
<th>탭1</th><th>탭2</th><th>홀</th><th>카운터</th>
<th>금액</th><th>삭제</th>
</tr>
</thead>
<tbody id="cartBody"></tbody>
</table>
<div style="text-align:right;font-weight:bold;">총 합계: <span id="grandTotal">0</span> 원</div>
</div>

<h2>4. 고객 정보</h2>
<input type="text" id="custName" placeholder="고객명">
<input type="text" id="custPhone" placeholder="연락처">
<input type="email" id="custEmail" placeholder="이메일">
<br><br>
<button onclick="submitQuote()">견적 요청</button>

</div>

<script>

if(!window._sb){
  window._sb = window.supabase.createClient(
    "https://ritzqnjgivmrtysulzil.supabase.co",  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpdHpxbmpnaXZtcnR5c3VsemlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5ODA2MjMsImV4cCI6MjA4NzU1NjYyM30.oTeXacJlkMXKw1G4IRWUa3G2DM1wPvFl-9rzf5IdsxY"
  );
}

const prices = {
  2020:{silver:3900,black:6000},
  2040:{silver:6900,black:9000},
  3030:{silver:8900,black:11000},
  3060:{silver:14000,black:18000},
  4040:{silver:16000,black:19000},
  4080:{silver:28000,black:30000}
};

let selectedSize = "2020";

function createSizeButtons(){
  const grid = document.getElementById("sizeGrid");
  if(!grid) return;

  grid.innerHTML = "";

  Object.keys(prices).forEach(size=>{
    const btn = document.createElement("button");
    btn.innerText = size;
    btn.className = "size-btn";

    btn.onclick = function(){
      document.querySelectorAll(".size-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      selectedSize = size;
      updatePrice();
    };

    grid.appendChild(btn);
  });

  document.querySelector(".size-btn").classList.add("active");
}

function calculateLine(size,color,length,qty,tapOne,tapTwo,hole,counter){

  const errorBox = document.getElementById("lengthError");
  if(errorBox) errorBox.innerText = "";

  if(length && length < 50){
    if(errorBox) errorBox.innerText="최소 50mm 이상 입력";
    return 0;
  }

  if(length > 3000){
    if(errorBox) errorBox.innerText="3m 초과 불가";
    return 0;
  }

  const unit100 = Math.ceil(length/100);
  const base100 = prices[size][color]/10;

  let total = unit100 * base100 * qty;

  total += 300 * tapOne;
  total += 600 * tapTwo;
  total += 400 * hole;
  total += 1000 * counter;

  return total;
}

function updatePrice(){

  const color = document.getElementById("color").value;
  const length = parseInt(document.getElementById("length").value)||0;
  const qty = parseInt(document.getElementById("qty").value)||0;
  const tapOne = parseInt(document.getElementById("tapOneQty").value)||0;
  const tapTwo = parseInt(document.getElementById("tapTwoQty").value)||0;
  const hole = parseInt(document.getElementById("holeQty").value)||0;
  const counter = parseInt(document.getElementById("counterQty").value)||0;

  const total = calculateLine(
    selectedSize,
    color,
    length,
    qty,
    tapOne,
    tapTwo,
    hole,
    counter
  );

  const priceBox = document.getElementById("price");
  if(priceBox) priceBox.innerText = total.toLocaleString()+" 원";
}

document.addEventListener("input",updatePrice);

function addToCart(){

  const color = document.getElementById("color").value;
  const length = parseInt(document.getElementById("length").value)||0;
  const qty = parseInt(document.getElementById("qty").value)||0;
  const tapOne = parseInt(document.getElementById("tapOneQty").value)||0;
  const tapTwo = parseInt(document.getElementById("tapTwoQty").value)||0;
  const hole = parseInt(document.getElementById("holeQty").value)||0;
  const counter = parseInt(document.getElementById("counterQty").value)||0;

  if(!length || !qty){
    alert("길이/수량 입력");
    return;
  }

  const total = calculateLine(
    selectedSize,
    color,
    length,
    qty,
    tapOne,
    tapTwo,
    hole,
    counter
  );

  const div = document.createElement("div");
  div.className="cart-item";

  div.innerHTML = `
    <strong>${selectedSize}</strong> (${color})<br>
    길이 ${length}mm / 수량 ${qty}<br>
    한쪽탭 ${tapOne} / 양쪽탭 ${tapTwo} / 홀 ${hole} / 카운터 ${counter}<br>
    금액 <span class="linePrice">${total.toLocaleString()}</span> 원
    <br>
    <button onclick="this.parentElement.remove();updateGrand();">삭제</button>
  `;

  document.getElementById("cartList").appendChild(div);
  updateGrand();
}

function updateGrand(){
  let sum=0;
  document.querySelectorAll(".linePrice").forEach(p=>{
    sum += parseInt(p.innerText.replace(/,/g,''))||0;
  });
  document.getElementById("grandTotal").innerText=sum.toLocaleString();
}

document.addEventListener("DOMContentLoaded",function(){
  createSizeButtons();
  updatePrice();
});

</script>

</body>
</html>


